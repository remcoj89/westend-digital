---
import FaqAccordion from "../components/FaqAccordion.astro";
import Image from "astro/components/Image.astro";

const { title, faqs, sectionId } = Astro.props;
---

<section class="wrapper faq-section" id={sectionId}>
  <header>
    <h2>{title}</h2>
    <span class="section-subtitle"
      >Niet het antwoord dat je zoekt? Je kunt ons ook altijd even
      <a href="mailto:info@westend-digital.nl">mailen.</a>
    </span>
  </header>

  <div class="faq-wrapper">
    <ul class="faqs" role="list">
      {
        faqs.map((faq, i) => {
          return (
            <FaqAccordion
              question={faq.question}
              answer={faq.answer}
              link={faq.internalLink}
              index={i}
            />
          );
        })
      }
    </ul>
    <Image
      alt="Vraagtekens om de FAQ sectie te symboliseren"
      class="faq-image"
      src="/images/questions-marks.webp"
      height="500"
      width="500"
    />
  </div>
</section>

<style>
  #webcheck-faq {
    margin-block-end: var(--size-10);
  }
  .faq-section {
    display: grid;

    header {
      text-align: center;
      margin-block-end: var(--size-6);

      .section-subtitle {
        font-size: var(--fs-500);
      }
    }

    .faq-wrapper {
      display: flex;
      gap: var(--size-1);

      .faqs {
        display: flex;
        flex-direction: column;
        gap: var(--size-2);
      }

      .faq-image {
        display: none;
        border-radius: var(--border-radius-img);
        box-shadow: var(--box-shadow);
        object-fit: cover;
        object-position: center;
        height: 50vh;
        width: 100%;
      }
      /*
      @media (width >= 43.75em) {
        .faq-wrapper {
          grid-column: 2 / -2;
        }
      } */
      @media (width >= 62.5em) {
        .faq-image {
          display: block;
          grid-column: 9 / -2;
          width: fit-content;
        }
      }
    }
  }
</style>

<script is:inline>
  const faqWrapper = document.querySelector(".faq-wrapper");
  const accordions = document.querySelectorAll(".accordion");

  // Functie om alle accordions te sluiten en ARIA-attributen te resetten
  const closeAllAccordions = () => {
    accordions.forEach((accordion) => {
      const trigger = accordion.querySelector(".accordion-trigger");
      const content = accordion.querySelector(".accordion-content");

      accordion.classList.remove("is__open");
      if (trigger) trigger.setAttribute("aria-expanded", "false");
      if (content) content.setAttribute("aria-hidden", "true");
    });
  };

  faqWrapper.addEventListener("click", (e) => {
    const trigger = e.target.closest(".accordion-trigger");

    // Stop als er niet op een trigger (knop) is geklikt
    if (!trigger) return;

    const accordion = trigger.closest(".accordion");
    const content = accordion.querySelector(".accordion-content");
    const isOpen = accordion.classList.contains("is__open");

    // Als de geklikte accordion al open was, sluit alles en stop.
    // Anders, sluit eerst alles en open daarna de juiste.
    if (isOpen) {
      closeAllAccordions();
    } else {
      closeAllAccordions();
      accordion.classList.add("is__open");
      trigger.setAttribute("aria-expanded", "true");
      if (content) content.setAttribute("aria-hidden", "false");
    }
  });

  // Event listener voor klikken buiten de FAQ-wrapper
  document.addEventListener("click", (e) => {
    if (!faqWrapper.contains(e.target)) {
      closeAllAccordions();
    }
  });

  // Event listener voor de Escape-toets
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closeAllAccordions();
    }
  });
</script>
