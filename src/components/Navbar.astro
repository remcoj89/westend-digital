---
import { Image } from "astro:assets";
import { ArrowIconDown, BurgerMenu, CloseIcon } from "../assets/icons.jsx";

import data from "../data/site.json";

const logo = "/assets/logos/WestendDigitalLogo.svg";
---

<nav class="nav-wrapper">
  <div class="wrapper nav-bar">
    <input type="radio" name="nav-radio" class="nav-button" id="cancelButton" />
    <input type="radio" name="nav-radio" class="nav-button" id="menuButton" />
    <a href="/">
      <Image
        alt="logo Westend-digital"
        class="logo"
        src={logo}
        height={250}
        width={250}
      />
    </a>

    <div class="nav-list-wrapper">
      <ul role="list" class="nav-list">
        <li class="nav-link"><a href="/">Home</a></li>
        <li class="dropdown">
          <button class="dropbtn">Diensten <ArrowIconDown /></button>
          <ul role="list" class="dropdown-content" id="myDropdown">
            <li class="nav-link"><a href="/diensten/websites">Websites</a></li>
          </ul>
        </li>
        <li class="nav-link"><a href="/werk">Werk</a></li>
        <li class="dropdown">
          <button class="dropbtn">Resources <ArrowIconDown /></button>
          <ul role="list" class="dropdown-content" id="myDropdown">
            <li class="nav-link"><a href="/blog-artikelen">Blog</a></li>
            <li class="nav-link"><a href="/tools">Tools</a></li>
          </ul>
        </li>
        <li class="nav-link"><a href="/over-westend-digital">Over mij</a></li>
        <li class="nav-link cta-btn"><a href="/contact">Contact</a></li>
      </ul>
    </div>
    <label for="cancelButton" class="cancelButton">
      <input type="checkbox" name="cancleButton" id="cancleButton" />
      <CloseIcon iconFill="var(--clr-primary-100" />
    </label>
    <label for="menuButton" class="burgerMenu">
      <input type="checkbox" name="menuButton" id="cancleButton" />
      <BurgerMenu iconFill="var(--clr-primary-100" />
    </label>
  </div>
</nav>

<script>
  document.querySelectorAll(".dropdown").forEach((dropdown) => {
    const dropbtn = dropdown.querySelector(".dropbtn");
    const dropdownContent = dropdown.querySelector(".dropdown-content");

    // Open/close voor elke dropdown
    if (dropbtn && dropdownContent) {
      dropbtn.addEventListener("click", (e) => {
        e.stopPropagation(); // voorkom directe sluiting

        // Eerst alle andere dropdowns sluiten
        document.querySelectorAll(".dropdown-content.show")
          .forEach((openDropdown) => {
            if (openDropdown !== dropdownContent) {
              openDropdown.classList.remove("show");
            }
          });

        // Toggle huidige dropdown
        dropdownContent.classList.toggle("show");
      });
    }

    // Klik BUITEN deze specifieke dropdown => sluit 'm
    document.addEventListener("click", (e) => {
      if (!dropdown.contains(e.target as Node)) {
        dropdownContent?.classList.remove("show");
      }
    });

    // ESC sluit alleen als deze dropdown open is
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        dropdownContent?.classList.remove("show");
      }
    });
  });
</script>

<style>
  .nav-wrapper {
    background-color: var(--clr-primary-900);
    color: var(--clr-primary-100);

    input {
      display: none;
    }

    .nav-bar {
      align-items: center;
      display: flex;
      font-size: var(--fs-500);
      height: 100%;
      justify-content: space-between;
      position: relative;

      z-index: 999;

      .logo {
        height: var(--size-10);
        object-fit: contain;
      }

      .nav-list-wrapper {
        display: none;
        grid-template-rows: 0fr;
        inset-block-start: var(--size-10);
        justify-content: center;
        position: absolute;
        text-align: center;
        transition: grid-template-rows 500ms ease-in-out;
        width: 100%;

        .nav-list {
          /* overflow: hidden; */
        }

        .nav-link,
        .dropbtn {
          color: inherit;
          cursor: pointer;
          line-height: 250%;
          text-decoration: none;
          font-size: var(--fs-500);
          transition: all 0.5s ease-out;

          &:hover,
          &:active {
            color: var(--clr-secondary-900);
            border-bottom: solid 2px;
          }
        }

        /* Dropdown Button */
        .dropbtn {
          align-items: center;
          background-color: transparent;
          border: none;
          display: flex;
          font-weight: var(--fw-regular);
          gap: 0.5rem;
          margin: 0;
          padding: 0;
        }

        /* The container <li> - needed to position the dropdown content */
        .dropdown {
          position: relative;
          display: inline-block;

          /* Dropdown Content (Hidden by Default) */
          .dropdown-content {
            background-color: var(--clr-primary-100);
            box-shadow: var(--box-shadow);
            display: none;
            min-width: 16rem;
            position: absolute;
            z-index: 9999;


            .nav-link a {
              padding: var(--size-1) var(--size-2);
              color: var(--clr-primary-900);
              text-decoration: none;
              display: block;
              /* Change color of dropdown links on hover */
              &:hover,
              &:active {
                background-color: var(--clr-secondary-900);
                border-bottom: none;
              }
            }
          }

          /* Show the dropdown menu (use JS to add this class to the .dropdown-content container when the user clicks on the dropdown button) */
          .show {
            display: block;
            top: 7rem;
          }
        }

        .dropdown:has(.dropdown-content.show) .dropbtn,
        .dropdown:has(.dropdown-content.show) .dropbtn:hover,
        .dropdown:has(.dropdown-content.show) .dropbtn:active {
          border-bottom: 0; /* evt. !important als nodig */
        }

        .cta-btn {
          background-color: var(--clr-secondary-900);
          border: solid 2px var(--clr-secondary-900);
          border-radius: var(--border-radius-btn);
          padding-inline: var(--size-1);
          color: var(--clr-primary-900);
          font-weight: var(--fw-semi-bold);

          &:hover {
            background-color: transparent;
            color: var(--clr-secondary-900);
            border-bottom: solid 2px var(--clr-secondary-900);
          }
        }

        a {
          text-decoration: none;
        }
      }

      @media (width > 870px) {
        .nav-list-wrapper {
          display: block;
          grid-template-rows: unset;
          inset-block-start: unset;
          position: static;

          .nav-list {
            display: flex;
            gap: var(--size-1);
            justify-content: flex-end;
          }
        }

        .burgerMenu {
          display: none;
        }
      }

      .cancelButton {
        display: none;
      }

      @media (width <= 870px) {
        .nav-list-wrapper {
          display: none;
        }

        #menuButton:checked ~ .cancelButton {
          display: block;
        }

        #menuButton:checked ~ .burgerMenu {
          display: none;
        }

        #menuButton:checked ~ .nav-list-wrapper {
          background-color: var(--clr-primary-900);
          grid-template-rows: 1fr;
          padding-block: var(--size-5);
          display: block;
        }

        #menuButton:checked ~ .nav-wrapper {
          background-color: var(--clr-primary-900);
        }
      }
    }
  }

  @media (width >= 870px) {
    .nav-wrapper {
      --_animationDistance: 105vh;
      --_animationStartsAfter: 100vh;
      animation: stickyNav linear forwards;
      inset-inline: 0;
      /* background-color: transparent; */
      position: fixed;
      top: 0;
      z-index: 1000;

      @supports (animation-timeline: view()) {
        animation-range: var(--_animationStartsAfter) var(--_animationDistance);
        animation-timeline: view();
      }
    }
  }

  .nav-wrapper:has(#menuButton:checked) {
    background-color: var(--clr-primary-900);
    box-shadow: 0 0 0.75rem hsl(224 76% 11% / 0.3);

    .nav-list-wrapper {
      display: grid;
    }
  }

  .hidden {
    display: none;
  }

  .active {
    background-color: var(--clr-primary-900);
  }

  @keyframes stickyNav {
    100% {
      background-color: var(--clr-primary-900);
      box-shadow: 0 0 0.75rem hsl(224 76% 11% / 0.3);
      color: var(--clr-primary-100);
    }
  }
</style>
